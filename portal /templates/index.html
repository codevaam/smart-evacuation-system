<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    </head>
    <body>

        <div class="stats-div">
            <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-top-fixed">
                <a class="navbar-brand" href="#">GTFO</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#stats-div">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#video-stream">Stream</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#log-div">Logs</a>
                    </li>
                    </ul>
                    <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
            </nav>
            <div class="text-center mb-3">
                Filter rooms:
                <button class="btn btn-success">Empty</button>
                <button class="btn btn-danger">Not empty</button>
            </div>
            <div class="row justify-content-around my-auto" id="room-status-div">
                <!-- axios call -->
            </div>
        </div>
        <div class="stream-div" id="video-stream">
            <img class="stream" src=""></img>
        </div>
        <div class="logs" id="log-div">
            <!-- axios call -->
        </div>
        <canvas id="graph"></canvas>
    </body>

    <style>
        .stream {
            width: 100%;
            height: auto;
        }
        .stats-div {
            height: 100vh;
        }
        .card {
            border-color: lightgray;
            border-width: 1px;
            border-radius: 10px;
            padding: 20px;
        }
        .card:hover {
            border-color: blue;
        }
        .logs {
            width: 100%;
            height: 100vh;
        }
    </style>
    <script>
        function scrollToStream(a) {
            console.log(a)
            var elem = document.getElementById("video-stream")
            elem.scrollIntoView()
        }
        // axios.get('http://localhost:5000/api/log/1/1')
        // .then(res=>console.log(res))
        axios.get('http://localhost:5000/api/log')
        .then(res=> {
            var length = res.data.length
            var lastUpdate = res.data[length-1]
            let doors = ['door1', 'door2']
            var div = document.getElementById('room-status-div');
            var html = '';
            for(var i in doors) {
                var entry = 'lastUpdate.'+doors[i]+'_entries'
                var entryCount = eval(entry);
                var exit = 'lastUpdate.'+doors[i]+'_exits';
                var exitCount = eval(exit)
                console.log(entry)
                html+=`<div class="card col-2">
                    <h4 class="text-center">${doors[i]}</h4>
                    <p>Entry: ${entryCount}</p>
                    <p>Exit: ${exitCount}</p>
                    <button class="btn btn-primary" onclick="scrollToStream()">Watch stream</button>
                </div>`
            }
            div.innerHTML = html

            var html2 = '';
            html2+=`<table class="table">
                <thead>
                    <tr>
                    <th scope="col">Time Stamp</th>
                    <th scope="col">Total Entries</th>
                    <th scope="col">Total Exits</th>
                    </tr>
                </thead>
                <tbody>
                `
            var div2 = document.getElementById('log-div');
            var resArr = res.data;
            var room1In = [];
            var timeStamps1 = [];
            for(var i in res.data) {
                var inside = resArr[i].door1_exits - resArr[i].door1_entries
                room1In.push(inside)
                timeStamps1.push(resArr[i].ts)
                html2+=`
                    <tr>
                    <th scope="row">${res.data[i].ts}</th>
                    <td>${res.data[i].door1_entries}</td>
                    <td>${res.data[i].door1_exits}</td>
                    </tr>`
            }
            html2+='</tbody></table>'
            div2.innerHTML = html2


            var ctx = document.getElementById('graph').getContext('2d');
            var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',
                
                // The data for our dataset
                data: {
                    labels: timeStamps1,
                    datasets: [{
                        label: 'IN',
                        borderColor: 'rgb(255, 99, 132)',
                        data: room1In
                    }]
                },

                // Configuration options go here
                options: {}
            });
        })

        
    </script>
</html>
